---
import type { HTMLAttributes } from 'astro/types';

type Props = HTMLAttributes<'a'>;

const { href, class: className, ...props } = Astro.props;
const pathname = Astro.url.pathname.replace(import.meta.env.BASE_URL, '');

// Clean the path by removing language prefix if present
const cleanPath = (path: string) => {
	if (!path) return '';
	const p = path.startsWith('/') ? path.slice(1) : path;
	const segments = p.split('/');
	// Check if first segment is a language code (e.g. 'pt-br')
	if (segments.length > 0 && (segments[0] === 'pt-br' || segments[0] === 'en')) {
		return '/' + segments.slice(1).join('/');
	}
	return path.startsWith('/') ? path : '/' + path;
};

const normalize = (path: string) => {
	if (!path) return '';
	if (path === '/') return path;
	return path.endsWith('/') ? path.slice(0, -1) : path;
};

const targetPath = normalize(cleanPath(href?.toString() || ''));
const currentPath = normalize(cleanPath(pathname));

const subpath = currentPath.substring(1).split('/');
const isActive = targetPath === currentPath || targetPath === '/' + subpath[0];
---

<a href={href} class:list={[className, { active: isActive }]} {...props}>
	<slot />
</a>
<style>
	a {
		display: inline-block;
		text-decoration: none;
	}
	a.active {
		font-weight: bolder;
		text-decoration: underline;
	}
</style>
