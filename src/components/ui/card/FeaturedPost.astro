---
import { Image } from "astro:assets";
import type { CollectionEntry } from "astro:content";
import FormattedDate from "../../FormattedDate.astro";
import { slugifyTag as slugify } from "../../../lib/slug";

import { author } from "../../../data/en/author";

interface Props {
  post: CollectionEntry<"blog">;
  readingTimeMin?: number;
  lang?: 'en' | 'pt-br';
}
const { post, readingTimeMin = 0, lang = 'en' } = Astro.props as Props;

const slug = post.id.replace(new RegExp(`^${lang}/`), '');
const rootPath = lang === 'en' ? '/blog' : `/${lang}/blog`;
---

<div
  class="grid grid-cols-1 md:grid-cols-[1fr_2fr] gap-5 md:gap-6 items-stretch relative"
>
  {
    post.data.heroImage && (
      <div
        class="md:col-span-1 relative overflow-hidden rounded-lg aspect-square self-start"
        style="aspect-ratio: 1 / 1;"
      >
        <Image
          class="h-full object-cover object-center"
          src={post.data.heroImage}
          alt={post.data.title}
        />
      </div>
    )
  }
  <div class="md:col-span-1 space-y-2 md:space-y-3">
    <div
      class="flex items-center gap-2 text-xs uppercase tracking-wide text-[color:var(--color-text-muted)]"
    >
      <span class="sw-tag border border-[color:var(--color-border-light)]"
        ><span class="text-[color:var(--accent)]">★</span> Featured</span
      >
    </div>
    <h3
      class="text-2xl md:text-3xl font-bold text-[color:var(--color-text-primary)]"
    >
      {post.data.title}
    </h3>
    {
      post.data.description && (
        <p class="text-[color:var(--color-text-secondary)]">
          {post.data.description}
        </p>
      )
    }
    <div
      class="flex items-center gap-3 text-sm text-[color:var(--color-text-muted)]"
    >
      <FormattedDate date={post.data.pubDate} locale={lang} />
      <span>•</span>
      <a
        href={`${rootPath}/author/${slugify(post.data.author || author.name)}/`}
        class="hover:text-[color:var(--accent)]"
        >{post.data.author || author.name}</a
      >
      {
        readingTimeMin > 0 && (
          <>
            <span>•</span>
            <span class="flex items-center gap-1">
              <svg
                viewBox="0 0 24 24"
                width="14"
                height="14"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                aria-hidden="true"
              >
                <circle cx="12" cy="12" r="9" />
                <path d="M12 7v5l3 3" />
              </svg>
              {readingTimeMin} min read
            </span>
          </>
        )
      }
    </div>
    {
      post.data.tags && post.data.tags.length > 0 && (
        <div class="flex gap-2 flex-wrap">
          {post.data.tags.map((t) => (
            <a
              href={`${rootPath}/tag/${t.replace(/\s+/g, "-").toLowerCase()}/`}
              class="sw-tag"
            >
              {t}
            </a>
          ))}
        </div>
      )
    }
  </div>
  <a
    href={`${rootPath}/${slug}/`}
    class="stretched-link"
    aria-label={post.data.title}></a>
</div>
